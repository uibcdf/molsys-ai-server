# Example environment file for MolSys-AI services (systemd EnvironmentFile).
# Copy to: /etc/molsys-ai/molsys-ai.env

# CUDA Toolkit (required for vLLM FlashInfer JIT via nvcc).
CUDA_HOME=/usr/local/cuda
# Ensure nvcc is visible for JIT compilation.
PATH=/usr/local/cuda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# ---- model_server ----
# Path to a vLLM YAML config (see `server/model_server/config.example.yaml`).
MOLSYS_AI_MODEL_CONFIG=/etc/molsys-ai/model_server.yaml

# Protect the internal engine endpoint (`POST /v1/engine/chat`) (comma-separated allowlist).
# Example: generate a random key with `python -c 'import secrets; print(secrets.token_urlsafe(48))'`
MOLSYS_AI_ENGINE_API_KEYS=CHANGE_ME

# ---- chat_api ----
# Engine base URL (chat_api will call `${MOLSYS_AI_ENGINE_URL}/v1/engine/chat`).
MOLSYS_AI_ENGINE_URL=http://127.0.0.1:8001

# chat_api must authenticate to the engine server when `MOLSYS_AI_ENGINE_API_KEYS` is set.
# Use one of the keys from `MOLSYS_AI_ENGINE_API_KEYS`.
MOLSYS_AI_ENGINE_API_KEY=CHANGE_ME

# Allow docs to call the public endpoint from GitHub Pages.
MOLSYS_AI_CORS_ORIGINS=https://uibcdf.org,https://www.uibcdf.org

# Docs corpus + index paths.
# Recommended for production: keep generated artifacts outside the git checkout.
# Example:
#   sudo mkdir -p /var/lib/molsys-ai
#   sudo chown -R <service-user>:<service-group> /var/lib/molsys-ai
#   python /opt/molsys-ai-server/dev/sync_rag_corpus.py --clean --build-index \
#     --dest /var/lib/molsys-ai/docs --index /var/lib/molsys-ai/rag_index.pkl
#
# If unset, chat_api uses the repo defaults under `server/chat_api/data/`.
MOLSYS_AI_DOCS_DIR=
MOLSYS_AI_DOCS_INDEX=

# Embeddings backend for RAG:
# - sentence-transformers (recommended for quality, requires model weights)
# - hashing (offline fallback)
MOLSYS_AI_EMBEDDINGS=sentence-transformers

# RAG chunking defaults (affects index build time/quality).
MOLSYS_AI_RAG_CHUNK_MAX_CHARS=1600
MOLSYS_AI_RAG_CHUNK_MIN_CHARS=400
MOLSYS_AI_RAG_MAX_CHUNKS_PER_SOURCE=3

# Chat API request guards (recommended for public deployments).
MOLSYS_AI_CHAT_MAX_K=8
MOLSYS_AI_CHAT_MAX_MESSAGES=30
MOLSYS_AI_CHAT_MAX_MESSAGE_CHARS=4000
MOLSYS_AI_CHAT_MAX_TOTAL_CHARS=20000

# Optional: minimal in-process rate limit for public demos (requests per minute per IP).
# Prefer reverse-proxy rate limiting when available.
MOLSYS_AI_CHAT_RATE_LIMIT_PER_MIN=0

# Optional: force a RAG index rebuild on chat_api startup.
MOLSYS_AI_DOCS_INDEX_REBUILD=false

# Optional: override the chat API system prompt (advanced).
# MOLSYS_AI_CHAT_SYSTEM_PROMPT=...

# Optional: protect the public chat API endpoint too (usually leave empty).
MOLSYS_AI_CHAT_API_KEYS=
