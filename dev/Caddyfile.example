{
  # Global options (example).
  # Adjust log paths and admin endpoint as needed.
  #
  # This file is meant to be copied to `/etc/caddy/Caddyfile`.
}

api.uibcdf.org {
  encode zstd gzip

  # Minimal endpoint routing:
  # - /v1/docs-chat is for the public docs widget (CORS is handled by docs_chat).
  # - The model server (/v1/chat) stays on localhost; docs_chat calls it internally.
  reverse_proxy /v1/docs-chat* 127.0.0.1:8000

  # Optional: expose OpenAPI for docs_chat only (useful for debugging).
  reverse_proxy /docs* 127.0.0.1:8000
  reverse_proxy /openapi.json 127.0.0.1:8000

  # Public health check for the reverse proxy itself (does not verify GPU/model readiness).
  respond /healthz 200

  # Optional: pass-through health endpoints for internal services.
  # These are useful for monitoring and smoke tests.
  handle_path /healthz/docs-chat* {
    rewrite * /healthz
    reverse_proxy 127.0.0.1:8000
  }
  handle_path /healthz/model* {
    rewrite * /healthz
    reverse_proxy 127.0.0.1:8001
  }
}
