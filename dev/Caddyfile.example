{
  # Global options (example).
  # Adjust log paths and admin endpoint as needed.
  #
  # This file is meant to be copied to `/etc/caddy/Caddyfile`.
}

api.uibcdf.org {
  encode zstd gzip

  # Minimal endpoint routing:
  # - /v1/chat is the public chat API (widget + CLI).
  # - The model engine server (/v1/engine/chat) stays on localhost; chat_api calls it internally.
  reverse_proxy /v1/chat* 127.0.0.1:8000

  # Optional: expose OpenAPI for chat_api only (useful for debugging).
  reverse_proxy /docs* 127.0.0.1:8000
  reverse_proxy /openapi.json 127.0.0.1:8000

  # Public health check for the reverse proxy itself (does not verify GPU/model readiness).
  respond /healthz 200

  # Optional: pass-through health endpoints for internal services.
  # These are useful for monitoring and smoke tests.
  handle_path /healthz/chat* {
    rewrite * /healthz
    reverse_proxy 127.0.0.1:8000
  }
  handle_path /healthz/model* {
    rewrite * /healthz
    reverse_proxy 127.0.0.1:8001
  }
}
